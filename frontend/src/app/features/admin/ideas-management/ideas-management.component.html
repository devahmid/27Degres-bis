<mat-card>
  <mat-card-header>
    <mat-card-title class="text-2xl">Gestion des Idées</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <!-- Filtre par statut -->
    <div class="mb-6 pb-4 border-b border-gray-200">
      <label class="block text-dark font-medium mb-2">Filtrer par statut</label>
      <select
        [(ngModel)]="selectedStatus"
        (ngModelChange)="onStatusFilterChange()"
        class="w-full md:w-64 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-all bg-white text-gray-700">
        <option *ngFor="let status of statuses" [value]="status.value">
          {{ status.label }}
        </option>
      </select>
    </div>

    <div *ngIf="loading" class="text-center py-12">
      <mat-icon class="text-4xl text-gray-400 animate-spin">refresh</mat-icon>
      <p class="mt-4 text-gray-600">Chargement des idées...</p>
    </div>

    <div *ngIf="!loading && ideas.length === 0" class="text-center py-12">
      <mat-icon class="text-4xl text-gray-400">lightbulb_outline</mat-icon>
      <p class="mt-4 text-gray-600">Aucune idée trouvée</p>
    </div>

    <div *ngIf="!loading && ideas.length > 0" class="overflow-x-auto">
      <table mat-table [dataSource]="ideas" class="w-full">
        <!-- Title Column -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>Titre</th>
          <td mat-cell *matCellDef="let idea">
            <a [routerLink]="['/ideas', idea.id]" class="text-primary hover:underline font-medium">
              {{ idea.title }}
            </a>
          </td>
        </ng-container>

        <!-- Author Column -->
        <ng-container matColumnDef="author">
          <th mat-header-cell *matHeaderCellDef>Auteur</th>
          <td mat-cell *matCellDef="let idea">
            {{ idea.author.firstName }} {{ idea.author.lastName }}
          </td>
        </ng-container>

        <!-- Category Column -->
        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef>Catégorie</th>
          <td mat-cell *matCellDef="let idea">
            <mat-chip>{{ getCategoryLabel(idea.category) }}</mat-chip>
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Statut</th>
          <td mat-cell *matCellDef="let idea">
            <mat-chip [style.background-color]="getStatusColor(idea.status)">
              {{ getStatusLabel(idea.status) }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Votes Column -->
        <ng-container matColumnDef="votes">
          <th mat-header-cell *matHeaderCellDef>Votes</th>
          <td mat-cell *matCellDef="let idea" class="text-center">
            {{ idea.votes }}
          </td>
        </ng-container>

        <!-- Comments Column -->
        <ng-container matColumnDef="comments">
          <th mat-header-cell *matHeaderCellDef>Commentaires</th>
          <td mat-cell *matCellDef="let idea" class="text-center">
            {{ idea.commentsCount }}
          </td>
        </ng-container>

        <!-- Created At Column -->
        <ng-container matColumnDef="createdAt">
          <th mat-header-cell *matHeaderCellDef>Date de création</th>
          <td mat-cell *matCellDef="let idea">{{ idea.createdAt | dateFormat }}</td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let idea" class="relative">
            <button 
              mat-icon-button 
              type="button"
              [attr.data-idea-id]="idea.id"
              (click)="toggleMenu(idea.id, $event)"
              class="menu-button">
              <mat-icon>more_vert</mat-icon>
            </button>
            
            <!-- Custom Dropdown Menu -->
            <div 
              *ngIf="openMenuId === idea.id"
              class="menu-dropdown"
              [attr.data-menu-idea-id]="idea.id"
              (click)="$event.stopPropagation()">
              <div class="px-4 py-2 border-b border-gray-200">
                <p class="text-sm font-semibold text-gray-700">Changer le statut</p>
              </div>
              <ng-container *ngFor="let status of statuses">
                <button 
                  *ngIf="status.value && status.value !== idea.status"
                  class="menu-item w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2"
                  (click)="updateStatus(idea, status.value)">
                  <mat-icon class="text-lg">flag</mat-icon>
                  <span>{{ status.label }}</span>
                </button>
              </ng-container>
              <div class="border-t border-gray-200 my-1"></div>
              <button 
                class="menu-item w-full text-left px-4 py-2 hover:bg-red-50 text-red-600 flex items-center gap-2"
                (click)="deleteIdea(idea)">
                <mat-icon class="text-lg">delete</mat-icon>
                <span>Supprimer</span>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>
  </mat-card-content>
</mat-card>
