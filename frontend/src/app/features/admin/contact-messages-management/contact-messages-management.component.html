<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-dark">Messages de contact</h1>
  </div>

  <!-- Filters -->
  <div class="bg-white rounded-lg shadow p-4 mb-6">
    <div class="flex items-center gap-4">
      <label class="text-dark font-medium">Filtrer :</label>
      <select 
        [(ngModel)]="filterRead"
        (ngModelChange)="getFilteredMessages()"
        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
        <option value="all">Tous</option>
        <option value="unread">Non lus</option>
        <option value="read">Lus</option>
      </select>
      <div class="ml-auto text-sm text-gray-600">
        {{ filteredMessagesCount }} message{{ filteredMessagesCount > 1 ? 's' : '' }}
        <span *ngIf="filterRead === 'all'">
          ({{ unreadCount }} non lu{{ unreadCount > 1 ? 's' : '' }})
        </span>
      </div>
    </div>
  </div>

  <!-- Messages Table -->
  <div class="bg-white rounded-lg shadow overflow-hidden" *ngIf="!loading">
    <table mat-table [dataSource]="getFilteredMessages()" class="w-full" *ngIf="getFilteredMessages().length > 0">
      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Nom</th>
        <td mat-cell *matCellDef="let message" class="font-semibold">
          {{ message.name }}
          <span *ngIf="!message.isRead" class="ml-2 inline-block w-2 h-2 bg-primary rounded-full"></span>
        </td>
      </ng-container>

      <!-- Email Column -->
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef>Email</th>
        <td mat-cell *matCellDef="let message">
          <a [href]="'mailto:' + message.email" class="text-primary hover:underline">
            {{ message.email }}
          </a>
        </td>
      </ng-container>

      <!-- Subject Column -->
      <ng-container matColumnDef="subject">
        <th mat-header-cell *matHeaderCellDef>Sujet</th>
        <td mat-cell *matCellDef="let message">
          {{ message.subject || '(Sans sujet)' }}
        </td>
      </ng-container>

      <!-- Date Column -->
      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef>Date</th>
        <td mat-cell *matCellDef="let message" class="text-sm text-gray-600">
          {{ formatDate(message.createdAt) }}
        </td>
      </ng-container>

      <!-- Read Status Column -->
      <ng-container matColumnDef="isRead">
        <th mat-header-cell *matHeaderCellDef>Statut</th>
        <td mat-cell *matCellDef="let message">
          <mat-chip [class]="message.isRead ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'">
            {{ message.isRead ? 'Lu' : 'Non lu' }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let message">
          <button 
            mat-icon-button 
            color="primary"
            (click)="viewMessage(message)"
            matTooltip="Voir le message">
            <mat-icon>visibility</mat-icon>
          </button>
          <button 
            *ngIf="!message.isRead"
            mat-icon-button 
            color="accent"
            (click)="markAsRead(message)"
            matTooltip="Marquer comme lu">
            <mat-icon>mark_email_read</mat-icon>
          </button>
          <button 
            mat-icon-button 
            color="warn"
            (click)="deleteMessage(message)"
            matTooltip="Supprimer">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <div *ngIf="filteredMessagesCount === 0" class="text-center py-12 text-gray-500">
      <mat-icon class="text-6xl mb-4">mail_outline</mat-icon>
      <p>Aucun message trouv√©</p>
    </div>
  </div>

  <div *ngIf="loading" class="text-center py-12">
    <mat-icon class="animate-spin text-4xl text-primary">refresh</mat-icon>
    <p class="mt-4 text-gray-600">Chargement...</p>
  </div>
</div>

