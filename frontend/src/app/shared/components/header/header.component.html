<header class="header" [class.scrolled]="isScrolled">
  <div class="header-container">
    <!-- Logo -->
    <a routerLink="/" class="logo" (click)="closeMobileMenu()">
      <div class="logo-icon">
        <img src="/assets/logo.png" alt="Association 27 Degrés" class="logo-image">
      </div>
      <!-- <span class="logo-text">
        <span class="logo-number">27</span>
        <span class="logo-degrees">Degrés</span>
      </span> -->
    </a>

    <!-- Desktop Navigation -->
    <nav class="desktop-nav">
      <a 
        routerLink="/" 
        routerLinkActive="active" 
        [routerLinkActiveOptions]="{exact: true}"
        class="nav-link">
        <mat-icon>home</mat-icon>
        <span>Accueil</span>
      </a>
      <a routerLink="/about" routerLinkActive="active" class="nav-link">
        <mat-icon>info</mat-icon>
        <span>À propos</span>
      </a>
      <a routerLink="/news" routerLinkActive="active" class="nav-link">
        <mat-icon>article</mat-icon>
        <span>Actualités</span>
      </a>
      <a routerLink="/gallery" routerLinkActive="active" class="nav-link">
        <mat-icon>photo_library</mat-icon>
        <span>Photothèque</span>
      </a>
      <a routerLink="/shop" routerLinkActive="active" class="nav-link">
        <mat-icon>shopping_bag</mat-icon>
        <span>Boutique</span>
      </a>
      <a routerLink="/shop/cart" routerLinkActive="active" class="nav-link relative">
        <mat-icon>shopping_cart</mat-icon>
        <span>Panier</span>
        <span *ngIf="cartItemCount$ | async as count" class="absolute -top-1 -right-1 bg-accent text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">
          {{ count }}
        </span>
      </a>
      <a routerLink="/contact" routerLinkActive="active" class="nav-link">
        <mat-icon>mail</mat-icon>
        <span>Contact</span>
      </a>
    </nav>

    <!-- User Actions -->
    <div class="user-actions">
      <ng-container *ngIf="currentUser$ | async as user; else guest">
        <!-- User Menu -->
        <button 
          [matMenuTriggerFor]="userMenu" 
          class="user-menu-button"
          aria-label="Menu utilisateur"
          type="button"
          #menuTrigger="matMenuTrigger">
          <div class="user-avatar">
            <mat-icon *ngIf="!user.avatarUrl">account_circle</mat-icon>
            <img *ngIf="user.avatarUrl" [src]="user.avatarUrl" [alt]="user.firstName + ' ' + user.lastName">
          </div>
        </button>
        <mat-menu 
          #userMenu="matMenu" 
          class="user-menu"
          xPosition="before"
          yPosition="below"
          [overlapTrigger]="false"
          panelClass="user-menu-panel"
          (closed)="onMenuClosed()">
          <div class="user-menu-header">
            <div class="user-info">
              <div class="user-name">{{ user.firstName }} {{ user.lastName }}</div>
              <div class="user-email">{{ user.email }}</div>
            </div>
          </div>
          <mat-divider></mat-divider>
          <button mat-menu-item routerLink="/member/dashboard" (click)="closeMobileMenu()">
            <mat-icon>dashboard</mat-icon>
            <span>Tableau de bord</span>
          </button>
          <button mat-menu-item routerLink="/member/profile" (click)="closeMobileMenu()">
            <mat-icon>person</mat-icon>
            <span>Mon profil</span>
          </button>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>Déconnexion</span>
          </button>
        </mat-menu>
      </ng-container>
      <ng-template #guest>
        <a mat-button routerLink="/auth/login" class="login-button">
          <mat-icon>login</mat-icon>
          <span>Connexion</span>
        </a>
        <a mat-raised-button color="accent" routerLink="/auth/register" class="register-button">
          <mat-icon>person_add</mat-icon>
          <span>Devenir membre</span>
        </a>
      </ng-template>

      <!-- Mobile Menu Toggle -->
      <button 
        mat-icon-button 
        class="mobile-menu-toggle"
        (click)="toggleMobileMenu()"
        aria-label="Menu mobile">
        <mat-icon *ngIf="!isMobileMenuOpen">menu</mat-icon>
        <mat-icon *ngIf="isMobileMenuOpen">close</mat-icon>
      </button>
    </div>
  </div>

  <!-- Mobile Navigation Overlay -->
  <div 
    class="mobile-nav-overlay" 
    [class.open]="isMobileMenuOpen"
    (click)="closeMobileMenu()">
  </div>

  <!-- Mobile Navigation -->
  <nav class="mobile-nav" [class.open]="isMobileMenuOpen">
    <div class="mobile-nav-content">
      <a 
        routerLink="/" 
        routerLinkActive="active" 
        [routerLinkActiveOptions]="{exact: true}"
        class="mobile-nav-link"
        (click)="closeMobileMenu()">
        <mat-icon>home</mat-icon>
        <span>Accueil</span>
      </a>
      <a routerLink="/about" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileMenu()">
        <mat-icon>info</mat-icon>
        <span>À propos</span>
      </a>
      <a routerLink="/news" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileMenu()">
        <mat-icon>article</mat-icon>
        <span>Actualités</span>
      </a>
      <a routerLink="/gallery" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileMenu()">
        <mat-icon>photo_library</mat-icon>
        <span>Photothèque</span>
      </a>
      <a routerLink="/shop" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileMenu()">
        <mat-icon>shopping_bag</mat-icon>
        <span>Boutique</span>
      </a>
      <a routerLink="/shop/cart" routerLinkActive="active" class="mobile-nav-link relative" (click)="closeMobileMenu()">
        <mat-icon>shopping_cart</mat-icon>
        <span>Panier</span>
        <span *ngIf="cartItemCount$ | async as count" class="absolute top-0 right-0 bg-accent text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">
          {{ count }}
        </span>
      </a>
      <a routerLink="/contact" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileMenu()">
        <mat-icon>mail</mat-icon>
        <span>Contact</span>
      </a>
      <ng-container *ngIf="currentUser$ | async as user">
        <mat-divider class="mobile-divider"></mat-divider>
        <a routerLink="/member/dashboard" class="mobile-nav-link" (click)="closeMobileMenu()">
          <mat-icon>dashboard</mat-icon>
          <span>Tableau de bord</span>
        </a>
        <a routerLink="/member/profile" class="mobile-nav-link" (click)="closeMobileMenu()">
          <mat-icon>person</mat-icon>
          <span>Mon profil</span>
        </a>
        <button mat-button class="mobile-nav-link logout-link" (click)="logout(); closeMobileMenu()">
          <mat-icon>logout</mat-icon>
          <span>Déconnexion</span>
        </button>
      </ng-container>
      <ng-container *ngIf="!(currentUser$ | async)">
        <mat-divider class="mobile-divider"></mat-divider>
        <a routerLink="/auth/login" class="mobile-nav-link" (click)="closeMobileMenu()">
          <mat-icon>login</mat-icon>
          <span>Connexion</span>
        </a>
        <a routerLink="/auth/register" class="mobile-nav-link" (click)="closeMobileMenu()">
          <mat-icon>person_add</mat-icon>
          <span>Devenir membre</span>
        </a>
      </ng-container>
    </div>
  </nav>
</header>

